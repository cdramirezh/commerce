{% extends "auctions/layout.html" %}

{% block body%}

    {% if message %}
        <div>{{ message }}</div>
    {% else %}

        {% if user.is_authenticated %}
            <form action="{% url 'toggle_watchlist' auction.id %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="{{ watchlist_message }}">
            </form>
        {% else %}
        {% endif %}

        <h1>Title: {{ auction.title }}</h1>
        <p>Description: {{ auction.description }}</p>
        <p>Price {{ auction.price }}</p>
        <img src="{{ auction.image }}" alt="This auction has no image">

        {% if user.is_authenticated %}

            {% if auction.is_active %}

                {% if user_is_creator %}
                    <form action="{% url 'close' auction.id %}" method="POST">
                        {% csrf_token %}
                        <label for="id_close">Close auction</label>
                        <input id="id_close" type="submit" value="Close">
                    </form>
                {% else %}
                    <p>
                        ({{ number_of_bids }}) bids so far.
                        {% if user_is_last_bidder %}
                        Your bid is the current bid.
                        {% endif %}
                    </p>
                    <form action="{% url 'bid' auction.id %}" method="POST">
                        {% csrf_token %}
                        <label for="id_amount">Amount:</label>
                        <input id="id_amount" type="number" name="amount" min="{{ min_bid_value }}" required="">
                        <input type="submit" value="Bid">
                    </form>
                {% endif %}
            
            {% elif user_is_winner %}
                <div>You're the winner!</div>
            {% else %}
            {% endif %}
        {% endif %}
        
        <div>
            <h3>Details</h3>
            <ul>
                <li>Listed by: {{ user }}</li>
                <li>Category: 
                    {% if auction.get_category_display %}
                        {{auction.get_category_display}}
                    {% else %}
                        No category Listed
                    {% endif %}
                </li>
            </ul>
        </div>

        <div>
            <h1>Comments</h1>
            <form action="{% url 'add_comment' auction.id %}" method="POST">
                {% csrf_token %}
                {{ comment_form }}
                <input type="submit" value="Add comment">
            </form>
            {% for comment in comments %}
                <p>
                    <b>{{ comment.user }}: </b>
                    {{ comment.content }}
                </p>
            {% endfor %}
        </div>

    {% endif %}

{% endblock %}